function Sentence(){this.store={section:document.getElementById("section"),content:document.getElementById("content"),footer:document.getElementById("wrapper-buttons"),contentPosition:null,sentence:null,words:[],wordsLen:0,clones:[],wordPositions:[],itemsOnBoard:null,wrapper:null,wrapperBack:null,wrapperBackHeight:0,wrapperBackTop:0,nextArr:null,translationSpans:[],menuItems:[]},this.opts={easing:[.645,.045,.355,1],duration:200,valueX:400},this.state={transIn:!1,footerIn:!1,btns:{showTrans:!1,backHome:!1,nextArr:!1},level:"home",a:0,b:0,c:0,pct:[]},this._loadState(),this._begin()}Sentence.prototype={constructor:Sentence,_begin:function(){var e=this.store.content;this.store.contentPosition=e.getBoundingClientRect(),this._attachListeners(),"home"===this.state.level?(this._createMenu(),this.menuIn()):this._newSentence()},_newSentence:function(){this._changeColor(),this._removeHome(),this._toggleFooter(),this._getSentence(),this._createItemsOnBoard(),this._createSentence(),this._createClones(),this._createWrapperBack(),this._createTranslation(),this._createNextArr(),this._newSortable(),this._watchResize(!0),this._saveState(),this._comeIn()},_finishedSentence:function(){var e=this.state.level,t=this.state[e];"home"!==e&&(this._destroySortable(),this.state[e]=t+1,this._saveState(),this.showTrans(),this._toggleItems(),this._toggleNextArr())},nextSentence:function(){var e=this.state.level;if("home"!==e){var t=this,n=this._debounce(function(){t._toggleItems(),t._removeSentence(),t._cleanStore(),t._getSentence(),t._createSentence(),t._createClones(),t._animateWrapperBack(),t._createTranslation(),t._createNextArr(),t._newSortable(),t._watchResize(!0),t._toggleBtn("showTrans",!0),t._comeIn()},300);this._comeOut(n)}},backHome:function(){function e(){function e(){t._destroy(n),t._changeColor(),t._cleanStore(),t._createMenu(),t.menuIn()}t.state.level="home",t._saveState(),t._removeSentence(),t._removeWrapperBack(e)}if("home"!==this.state.level){var t=this,n=this.store.content.firstChild;this._watchResize(!1),this._toggleFooter(),this._comeOut(e)}},_createMenu:function(){var e=this,t=this.store.content,n=document.createElement("div"),s=document.createElement("button");n.className="items center",n.id="menu-home",s.className="btn-menu btn-menu-hidden";var o=s.cloneNode(!0),a=s.cloneNode(!0);this._getLevelsPct(),s.className+=" btn-menu-1",s.id="menuOutA",s.innerHTML='<span>Od podstaw</span><div class="percent">'+this.state.pct[0]+"%</div>",o.className+=" btn-menu-2",o.id="menuOutB",o.innerHTML='<span>Åšrednio-zaawansowane</span><div class="percent">'+this.state.pct[1]+"%</div>",a.className+=" btn-menu-3",a.id="menuOutC",a.innerHTML='<span>Zaawansowane</span><div class="percent">'+this.state.pct[2]+"%</div>",this.store.menuItems=[s,o,a],n.appendChild(s),n.appendChild(o),n.appendChild(a),t.appendChild(n)},_createItemsOnBoard:function(){var e=this.store.content,t=document.createElement("div");t.id="items",t.className="items items-on-board",this.store.itemsOnBoard=t,e.insertBefore(t,e.firstChild)},_createSentence:function(){var e=this.store.sentence,t=e.s,n=e.b;void 0===n&&(n=!1);var s=this.store.content,o=this.store.itemsOnBoard,a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),c,l,h;for(a.id="wrapper-words",r.className="btn-outer",i.className="btn-word",r.appendChild(i),c=t[0].concat(),c=c.sort(function(){return.5-Math.random()});this._checkSpill(c,t);)c=c.sort(function(){return.5-Math.random()});for(var p=0,d=c.length;d>p;p++)l=r.cloneNode(!0),l.dataset.pos=p+1,l.firstChild.innerHTML=c[p],a.appendChild(l),h=this.store.words.push(l);this.store.wordsLen=this.store.words.length,this.store.wrapper=a,o.appendChild(a)},_createClones:function(){var e=this,t=this.store.wrapper,n=this.store.itemsOnBoard,s=this.store.contentPosition,o=this.store.words,a=this.opts.valueX,r=[],i=[],c,l,h,p,d=document.createElement("div");d.className="clones",d.id="wrapper-clones",function(){for(var e=0,t=o.length;t>e;e++){var n=o[e];h=n.getBoundingClientRect(),r[e]={left:Math.round(h.left-s.left),top:Math.round(h.top-s.top),bottom:Math.round(h.bottom)},p=n.cloneNode(!0),p.className=p.className+" clone",Velocity.hook(p,"translateX",r[e].left+a+"px"),Velocity.hook(p,"translateY",r[e].top+"px"),d.appendChild(p),c=i.push(p)}}(),this.store.clones=i,this.store.wordPositions=r,t.parentNode.appendChild(d),this.store.clonesNodeList=n.querySelectorAll(".clone")},_createWrapperBack:function(){this._checkBackSize();var e=this,t=this.store.wrapper,n=this.store.wrapperBackHeight,s=this.store.wrapperBackTop,o=document.createElement("div");o.className="wrapper-back",o.style.height=n+"px",o.style.top=s+"px",Velocity.hook(o,"scaleY",0),this.store.wrapperBack=o,t.parentNode.appendChild(o),Velocity(o,{scaleY:[1,0]},{duration:1.5*e.opts.easing,easing:e.opts.easing,queue:!1})},_createTranslation:function(){var e=this.store.wrapperBack,t=this.store.sentence,n=t.t,s=document.createElement("p"),o=n.split(" "),a=[],r,i;s.id="translation",s.className="translation";for(var c=0,l=o.length;l>c;c++)r=document.createElement("span"),r.appendChild(document.createTextNode(o[c])),i=a.push(r),s.appendChild(r),l-1>c&&s.appendChild(document.createTextNode(" "));this.store.translationSpans=a,e.appendChild(s)},_createNextArr:function(){if("home"!==this.state.level){var e=this,t=this.store.itemsOnBoard,n=document.createElement("div"),s=document.createElement("button");n.className="wrapper-next-arr",n.id="wrapper-next-arr",s.className="next-arr",s.id="next-arr",s.type="button",s.innerHTML="&raquo",this.store.nextArr=s,s.addEventListener("click",function o(){e.nextSentence(),s.removeEventListener("click",o,!1)},!1),n.appendChild(s),t.appendChild(n)}},_newSortable:function(){var e=this,t=this.store.wrapper,n;t&&(n=new Sortable(t,{animation:0,onStart:function(t){e._toggleOpacity(t.item,"0.5")},onEnd:function(t){e._toggleOpacity(t.item,"1"),e._checkSentence()}}),this.store.sortable=n)},_removeHome:function(){try{var e=this.store.content,t=document.getElementById("menu-home"),n=t.cloneNode(!0),s=e.replaceChild(n,t),o=e.removeChild(n);s=o=null}catch(a){}},_removeFooter:function(){},_removeWrapperBack:function(e){var t=this,n=this.store.sentence.s[0].length,s=this.store.wrapperBack,o=this._debounce(function(){e()},50);Velocity(s,{scaleY:[0,1],opacity:[0,1]},{duration:1.5*t.opts.duration,easing:t.opts.easing,complete:function(e){e.forEach(function(e,t,n){o()})}})},_removeSentence:function(){var e=document.getElementById("translation"),t=document.getElementById("wrapper-words"),n=document.getElementById("wrapper-clones"),s=document.getElementById("wrapper-next-arr");this._destroy(t),this._destroy(n),this._destroy(e),this._destroy(s)},_destroySortable:function(){var e=this.store.sortable;e.destroy(),this.store.sortable=null},menuIn:function(){for(var e=this,t=this.store.menuItems,n,s=0,o=t.length;o>s;s++)n=t[s],Velocity(n,{opacity:[1,0],translateX:[0,"200px"]},{duration:2*e.opts.duration,easing:e.opts.easing,delay:100*s})},menuOut:function(e){if("home"===this.state.level){var t=this,n=document.querySelectorAll(".btn-menu"),s;this.state.level=e;for(var o=0,a=n.length;a>o;o++)s=n[o],Velocity(s,{opacity:[0,1],translateX:["-200px",0]},{duration:2*t.opts.duration,easing:t.opts.easing,delay:100*o,complete:function(e){e.forEach(function(e,s,o){e===n[a-1]&&t._newSentence()})}})}},animate:function(){var e=this,t=this.store.words,n=this.store.clones,s=this.store.contentPosition,o=this.store.wordPositions,a=[],r=this.store.wordsLen,i,c,l,h,p,d,u;d=this._debounce(function(){e._animateWrapperBack()},500),u=this._debounce(function(){for(var n=0;r>n;n++)i=t[n].getBoundingClientRect(),a[n]={left:Math.round(i.left-s.left),top:Math.round(i.top-s.top),bottom:Math.round(i.bottom-s.top)};e.store.wordPositions=a,console.log("get positions")},500,!0),u(),(p=this._debounce(function(){for(var t=0;r>t;t++)Velocity(n[t],{translateX:[a[t].left,o[t].left],translateY:[a[t].top,o[t].top]},{duration:e.opts.duration,easing:e.opts.easing,queue:!1,complete:function(e){}});console.log("animate clones")},1e3))()},_animateWrapperBack:function(){var e=this;if(wrapperBack=this.store.wrapperBack,changedWrapperBack=this._checkBackSize(),changedWrapperBack){var t=this.store.wrapperBackHeight,n=this.store.wrapperBackTop;Velocity(wrapperBack,{height:t,top:n},{duration:1.5*e.opts.duration,easing:e.opts.easing,queue:!1})}},showTrans:function(){if(!this.state.transIn&&"home"!==this.state.level){for(var e=this,t=this.store.translationSpans,n,s=0,o=t.length;o>s;s++)n=t[s],Velocity(n,{opacity:[1,0],translateX:[0,"200px"]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*s});this._toggleBtn("showTrans",!1),this.state.transIn=!0}},_toggleFooter:function(){var e=this.state.level,t=this.store.footer;this.state.footerIn?(t.parentNode.className="app-footer",this.state.footerIn=!1):(t.parentNode.className+=" app-footer-sentence",this.state.footerIn=!0),this._toggleBtn("showTrans",this.state.footerIn),this._toggleBtn("backHome",this.state.footerIn)},_toggleBtn:function(e,t){if(t!==this.state.btns[e]){var n=document.getElementById(e),s="btn-footer-hidden";this.state.btns[e]=t,this._toggleClass(n,s)}},_toggleNextArr:function(){if("home"!==this.state.level){var e=this,t=this.store.nextArr;this.state.btns.nextArr?(this.state.btns.nextArr=!1,Velocity(t,{scale:[0,1]},{duration:2*e.opts.duration,easing:e.opts.easing,delay:e.opts.duration,display:"none"})):(this.state.btns.nextArr=!0,Velocity(t,{scale:[1,0]},{duration:2*e.opts.duration,easing:e.opts.easing,delay:e.opts.duration,display:"block"}))}},_comeIn:function(){var e=this,t=this.store.wordPositions,n=this.store.clones,s=this.opts.valueX,o;!function(){for(var a=0,r=n.length;r>a;a++)o=t[a].left,Velocity(n[a],{opacity:1,translateX:[o,o+s]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*a+e.opts.duration,queue:!1})}()},_comeOut:function(e){if("home"!==this.state.level){var t=this,n=this.store.wordPositions,s=this.store.clones,o=this.store.nextArr,a=this.state.transIn,r=this.opts.valueX,i=this.store.wrapper.childNodes,c,l,h,p=this._debounce(function(){e()},50);if(a){var d=this.store.translationSpans;!function(){for(var e=0,n=d.length;n>e;e++)c=d[e],Velocity(c,{opacity:[0,1],translateX:["-200px",0]},{duration:t.opts.duration,easing:t.opts.easing,delay:100*e})}()}this.state.btns.nextArr&&this._toggleNextArr(),function(){for(var e=0,o=i.length;o>e;e++)h=i[e].dataset.pos-1,l=n[h].left,Velocity(s[h],{opacity:[0,1],translateX:[l-r,l]},{duration:t.opts.duration,easing:t.opts.easing,delay:100*e+t.opts.duration,queue:!1,complete:function(e){e.forEach(function(e,t,n){e===s[o-1]&&p()})}})}()}},_changeColor:function(){var e=this.store.section,t=" section-100",n=this.state.level;switch(n){case"a":e.className="section-green"+t;break;case"b":e.className="section-orange"+t;break;case"c":e.className="section-red"+t;break;case"home":e.className="section-dark"+t}},_toggleOpacity:function(e,t){try{var n=e.dataset.pos-1,s=this.store.clones[n];Velocity.hook(s,"opacity",t)}catch(o){}},_toggleItems:function(){var e=this.store.itemsOnBoard;"items items-on-board"===e.className?e.className+=" items-off":e.className="items items-on-board"},_getSentence:function(){try{var e=this.state.level,t=this.state[e],n;switch(e){case"a":n=arrayA(t,!1);break;case"b":n=arrayB(t,!1);break;case"c":n=arrayC(t,!1)}return this.store.sentence=n}catch(s){console.log(s)}},_getLevelsPct:function(){try{var e=this.state,t=arrayA(!1,!0),n=arrayB(!1,!0),s=arrayC(!1,!0),o=Math.round(100*e.a/t),a=Math.round(100*e.b/n),r=Math.round(100*e.c/s);e.pct=[o,a,r]}catch(i){}},_checkSentence:function(){var e=this,t=this.store.sentence,n=t.s,s=this.store.wrapper,o=[],a,r,i;(a=this._debounce(function(){r=s.querySelectorAll(".btn-word"),function(){for(var e=0,t=r.length;t>e;e++)i=o.push(r[e].innerHTML)}(),e._checkSpill(o,n)&&e._finishedSentence(),console.log("check sentence")},200))()},_checkBackSize:function(){try{for(var e=this.store.wordPositions,t=this.store.wrapperBackHeight,n=[],s=[],o,a,r,i,c=0,l=e.length;l>c;c++)o=e[c].top,a=e[c].bottom,n.push(o),s.push(a);if(console.log("check back size"),n.sort(),s.sort(),r=Math.floor(s[s.length-1]-n[0])+6,i=Math.floor(n[0]-3),t!==r)return this.store.wrapperBackHeight=r,this.store.wrapperBackTop=i,!0}catch(h){}},_watchResize:function(e){var t=this,n;e?(n=t._debounce(function(){t.animate()},250),window.addEventListener("resize",n,!1),t.store.resize=n,console.log("watch resize on")):(n=t.store.resize,window.removeEventListener("resize",n,!1),t.store.resize=null,console.log("watch resize off"))},_attachListeners:function(){var e=this;document.addEventListener("click",function t(n){var s=n.target;switch(s.id){case"showTrans":e.showTrans();break;case"backHome":e.backHome();break;case"resetState":e.resetState();break;case"menuOutA":e.menuOut("a");break;case"menuOutB":e.menuOut("b");break;case"menuOutC":e.menuOut("c")}})},_cleanStore:function(){this.store.sentence=this.store.wrapper=this.store.nextArr=this.store.translationSpans=null,this.store.wrapperBackHeight=this.store.wrapperBackTop=0,this.store.words=this.store.clones=this.store.wordPositions=this.store.translationSpans=[],this.state.transIn=this.state.btns.nextArr=!1,console.log("cleaned store")},_saveState:function(){var e=this.state,t=e.level,n=localStorage;n.setItem("level",t),console.log("saved level"),"home"!==t&&(n.setItem(t,e[t]),console.log("saved number"))},_loadState:function(){if(localStorage.length>0){var e=parseInt(localStorage.getItem("a")),t=parseInt(localStorage.getItem("b")),n=parseInt(localStorage.getItem("c"));this.state.level=localStorage.getItem("level"),e>=0&&(this.state.a=e),t>=0&&(this.state.b=t),n>=0&&(this.state.c=n),console.log("state loaded")}},resetState:function(){var e=localStorage;e.length>0&&(e.clear(),document.location.reload())},_debounce:function(e,t){var n,s,o,a;return function(){o=this,s=[].slice.call(arguments,0),a=new Date;var r=function(){var i=new Date-a;t>i?n=setTimeout(r,t-i):(n=null,e.apply(o,s))};n||(n=setTimeout(r,t))}},_toggleClass:function(e,t){if(e.classList)e.classList.toggle(t);else{var n=e.className.split(" "),s=n.indexOf(t);s>=0?n.splice(s,1):n.push(t),e.className=n.join(" ")}},_destroy:function(e){try{var t=e.parentNode,n=e.cloneNode(!0),s=t.replaceChild(n,e),o=t.removeChild(n);e=n=s=o=null}catch(a){console.log(a)}},_compareArrays:function(e,t){if(e&&t){if(e.length!==t.length)return!1;for(var n=0,s=e.length;s>n;n++)if(e[n]!==t[n])return!1;return!0}},_checkSpill:function(e,t){var n=this,s=t.every(function(t,s,o){return n._compareArrays(e,t)});return s}};var sentence=new Sentence;