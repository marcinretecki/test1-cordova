function Sentence(){this.store={content:document.getElementById("content"),footer:document.getElementById("wrapper-buttons"),contentPosition:null,sentence:null,words:[],clones:[],wordPositions:[],itemsOnBoard:null,wrapper:null,wrapperBack:null,wrapperBackHeight:0,wrapperBackTop:0,nextArr:null,translationSpans:null},this.opts={easing:[.645,.045,.355,1],duration:200,valueX:400},this.state={transIn:!1,no:0,level:"home"},this._loadState(),this._begin()}Sentence.prototype={constructor:Sentence,_begin:function(){var e=this.store.content;this.store.contentPosition=e.getBoundingClientRect(),"home"===this.state.level?this.homeIn():this._newSentence()},_newSentence:function(){this._changeColor(),this._removeHome(),this._createFooter(),this._createSentence(),this._createClones(),this._createWrapperBack(),this._createTranslation(),this._newSortable(),this._watchResize(!0),this._saveState(),this._comeIn()},_finishedSentence:function(){this._destroySortable(),this.showTrans(),this._itemsOff(),this._showNextArr()},nextSentence:function(){this.state.no+=1,this._comeOut(),this._cleanStore(),console.log(this.state.no)},backHome:function(){this._watchResize(!1),this.state.level="home",this._saveState()},_createSentence:function(){this._getSentence();var e=this.store.sentence,t=e.s,n=e.b;void 0===n&&(n=!1);var o=this.store.content,s=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),c,l,h;for(s.id="items",s.className="items items-on-board",a.id="wrapper-items",r.className="btn-outer",i.className="btn-word",r.appendChild(i),c=t[0].concat(),c=c.sort(function(){return.5-Math.random()});this._checkSpill(c,t);)c=c.sort(function(){return.5-Math.random()});for(var d=0,p=c.length;p>d;d++)l=r.cloneNode(!0),l.dataset.pos=d+1,l.firstChild.innerHTML=c[d],a.appendChild(l),h=this.store.words.push(l);this.store.wrapper=a,this.store.itemsOnBoard=s,s.appendChild(a),o.insertBefore(s,o.firstChild)},_createClones:function(){var e=this,t=this.store.wrapper,n=this.store.contentPosition,o=this.store.words,s=this.opts.valueX,a=[],r=[],i,c,l,h,d,p=document.createElement("div");p.className="clones",function(){for(var t=0,u=o.length;u>t;t++)l=o[t],h=l.getBoundingClientRect(),a[t]={left:Math.round(h.left-n.left),top:Math.round(h.top-n.top),bottom:Math.round(h.bottom)},c=e.store.wordPositions.push(a),d=l.cloneNode(!0),d.className=d.className+" clone",Velocity.hook(d,"translateX",a[t].left+s+"px"),Velocity.hook(d,"translateY",a[t].top+"px"),p.appendChild(d),i=r.push(d)}(),this.store.clones=r,this.store.wordPositions=a,t.parentNode.appendChild(p)},_createWrapperBack:function(){this._checkBackSize();var e=this,t=this.store.wrapper,n=this.store.wrapperBackHeight,o=this.store.wrapperBackTop,s=document.createElement("div");s.className="wrapper-back",s.style.height=n+"px",s.style.top=o+"px",Velocity.hook(s,"scaleY",0),this.store.wrapperBack=s,t.parentNode.appendChild(s),Velocity(s,{scaleY:[1,0]},{duration:300,easing:e.opts.easing,queue:!1})},_createTranslation:function(){var e=this.store.wrapperBack,t=this.store.sentence,n=t.t,o=document.createElement("p"),s,a;a=n.split(" ");for(var r=0,i=a.length;i>r;r++)s=document.createElement("span"),s.appendChild(document.createTextNode(a[r])),o.appendChild(s),i-1>r&&o.appendChild(document.createTextNode(" "));o.id="translation",o.className="translation",e.appendChild(o)},_createFooter:function(){var e=this,t=this.store.footer,n=document.createDocumentFragment(),o=document.createElement("button"),s=document.createElement("button"),a=t.querySelector(".btn-shop");o.className="btn-footer btn-translate",o.appendChild(document.createTextNode("? Tips")),o.type="button",s.className="btn-footer btn-back",s.appendChild(document.createTextNode("= Back")),s.type="button",o.addEventListener("click",function r(){e.showTrans(),o.removeEventListener("click",r,!1)},!1),s.addEventListener("click",function i(){e.backhome(),s.removeEventListener("click",i,!1)},!1),a.addEventListener("click",function c(){e._resetState(),a.removeEventListener("click",c,!1)},!1),n.appendChild(s),n.appendChild(o),t.appendChild(n)},_newSortable:function(){var e=this,t=this.store.wrapper,n;t&&(n=new Sortable(t,{animation:0,onStart:function(t){e._toggleOpacity(t.item,"0.5")},onEnd:function(t){e._toggleOpacity(t.item,"1"),e._checkSentence()}}),this.store.sortable=n)},_removeHome:function(){try{var e=this.store.content,t=document.getElementById("menu-home"),n=t.cloneNode(!0),o=e.replaceChild(n,t),s=e.removeChild(n);o=s=null}catch(a){}},_removeFooter:function(){},_removeSentence:function(){if("home"!==this.state.level){var e=this.store.itemsOnBoard,t=this.store.wrapperBack;this._destroy(e.firstChild),this._destroy(e.firstChild),this._destroy(t.firstChild),this._destroy(e.lastChild)}},_destroySortable:function(){if("home"!==this.state.level){var e=this.store.sortable;e.destroy(),this.store.sortable=null}},homeIn:function(){var e=this,t=document.createElement("div"),n="btn-menu btn-menu-hidden",o=document.createElement("button"),s=o.cloneNode(!0),a=o.cloneNode(!0),r=this.store.content,i,c;t.className="items center",t.id="menu-home",o.className=n+" btn-menu-1",o.innerHTML='<span>Od podstaw</span><div class="percent">87%</div>',o.addEventListener("click",function(){e.homeOut("a")}),s.className=n+" btn-menu-2",s.innerHTML='<span>Åšrednio-zaawansowane</span><div class="percent">100%</div>',s.addEventListener("click",function(){e.homeOut("b")}),a.className=n+" btn-menu-3",a.innerHTML='<span>Zaawansowane</span><div class="percent">5%</div>',a.addEventListener("click",function(){e.homeOut("c")}),t.appendChild(o),t.appendChild(s),t.appendChild(a),r.appendChild(t),i=[o,s,a];for(var l=0,h=i.length;h>l;l++)c=i[l],Velocity(c,{opacity:[1,0],translateX:[0,"200px"]},{duration:400,easing:e.opts.easing,delay:100*l})},homeOut:function(e){if("home"===this.state.level){var t=this,n=document.querySelectorAll(".btn-menu"),o;this.state.level=e;for(var s=0,a=n.length;a>s;s++)o=n[s],Velocity(o,{opacity:[0,1],translateX:["-200px",0]},{duration:400,easing:t.opts.easing,delay:100*s,complete:function(e){e.forEach(function(e,o,s){e===n[a-1]&&t._newSentence()})}})}},animate:function(){var e=this,t=this.store.words,n=this.store.clones,o=this.store.contentPosition,s=this.store.wrapperBack,a=this.store.wordPositions,r=this.store.wrapper,i=[],c=t.length,l,h,d,p,u,m;!function(){for(var e=0;c>e;e++);}(),function(){for(var e=0;c>e;e++)l=t[e].getBoundingClientRect(),i[e]={left:Math.round(l.left-o.left),top:Math.round(l.top-o.top),bottom:Math.round(l.bottom-o.top)}}(),this.store.wordPositions=i,u=this._debounce(function(){for(var t=0;c>t;t++)Velocity(n[t],{translateX:[i[t].left,a[t].left],translateY:[i[t].top,a[t].top]},{duration:e.opts.duration,easing:e.opts.easing,queue:!1})},10),u(),(m=this._debounce(function(){var t=e._checkBackSize();if(t){var n=e.store.wrapperBackHeight,o=e.store.wrapperBackTop;Velocity(s,{height:n,top:o},{duration:300,easing:e.opts.easing,queue:!1})}},100))()},showTrans:function(){if(!this.state.transIn&&"home"!==this.state.level){var e=this,t=this.store.content,n=t.querySelector(".translation"),o=n.querySelectorAll("span"),s=this.store.footer,a=s.querySelector(".btn-translate"),r;this.store.translationSpans=o;for(var i=0,c=o.length;c>i;i++)r=o[i],Velocity(r,{opacity:[1,0],translateX:[0,"200px"]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*i});Velocity(a,{opacity:[0,1]},{duration:e.opts.duration,easing:e.opts.easing,visibility:"hidden"}),this.state.transIn=!0}},_comeIn:function(){var e=this,t=this.store.contentPosition,n=this.store.wordPositions,o=this.store.clones,s=this.opts.valueX,a;!function(){for(var t=0,r=o.length;r>t;t++)a=n[t].left,Velocity(o[t],{opacity:1,translateX:[a,a+s]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*t+200,queue:!1})}()},_comeOut:function(){if("home"!==this.state.level){var e=this,t=this.store.wordPositions,n=this.store.clones,o=this.store.nextArr,s=this.store.translationSpans,a=this.opts.valueX,r=this.store.wrapper.childNodes,i,c,l,h;!function(){for(var t=0,n=s.length;n>t;t++)i=s[t],Velocity(i,{opacity:[0,1],translateX:["-200px",0]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*t})}(),h=this._debounce(function(){e._removeSentence()},300),function(){for(var o=0,s=r.length;s>o;o++)l=r[o].dataset.pos-1,c=t[l].left,Velocity(n[l],{opacity:1,translateX:[c-a,c]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*o+200,queue:!1,complete:function(e){e.forEach(function(e,t,o){e===n[s-1]&&h()})}})}(),Velocity(o,{scale:[0,1]},{duration:2*e.opts.duration,easing:e.opts.easing})}},_showNextArr:function(){if("home"!==this.state.level){var e=this,t=this.store.itemsOnBoard,n=document.createElement("div"),o=document.createElement("button");n.className="wrapper-next-arr",o.className="next-arr",o.id="next-arr",o.type="button",o.innerHTML="&raquo",this.store.nextArr=o,o.addEventListener("click",function s(){e.nextSentence(),o.removeEventListener("click",s,!1)},!1),n.appendChild(o),t.appendChild(n),Velocity(o,{scale:[1,0]},{duration:2*e.opts.duration,easing:e.opts.easing,delay:200})}},_changeColor:function(){try{var e=document.getElementById("section"),t=" section-100",n=this.state.level;switch(n){case"a":e.className="section-green"+t;break;case"b":e.className="section-orange"+t;break;case"c":e.className="section-red"+t;break;case"menu":e.className="section-dark"+t}}catch(o){}},_toggleOpacity:function(e,t){try{var n=e.dataset.pos-1,o=this.store.clones[n];Velocity.hook(o,"opacity",t)}catch(s){}},_itemsOff:function(){var e=this.store.itemsOnBoard;e.className=e.className+" items-off"},_getSentence:function(){try{var e=this.state.no,t=this.state.level,n;switch(t){case"a":n=arrayA(e);break;case"b":n=arrayB(e);break;case"c":n=arrayC(e)}return this.store.sentence=n}catch(o){console.log(o)}},_getLevels:function(){},_checkSentence:function(){var e=this,t=this.store.sentence,n=this.store.wrapper,o=[],s=!1,a,r,i,c,l;(a=this._debounce(function(){r=n.querySelectorAll(".btn-word"),function(){for(var e=0,t=r.length;t>e;e++)i=o.push(r[e].innerHTML)}(),c=function(){for(var e=0,n=t.s.length;n>e;e++)l=t.s[e],function(){for(var e=0,t=o.length;t>e;e++)if(o[e]!==l[e])return!1;s=!0}();return s},c()&&e._finishedSentence()},200))()},_checkBackSize:function(){try{for(var e=this.store.wordPositions,t=this.store.wrapperBackHeight,n=this.store.wrapperBackTop,o=[],s=[],a,r,i,c,l=0,h=e.length;h>l;l++)a=e[l].top,r=e[l].bottom,o.push(a),s.push(r);if(o.sort(),s.sort(),i=Math.floor(s[s.length-1]-o[0])+6,c=Math.floor(o[0]-3),t!==i)return this.store.wrapperBackHeight=i,this.store.wrapperBackTop=c,!0}catch(d){}},_watchResize:function(e){var t,n=this;e?(t=n._debounce(function(){n.animate()},250),n.store.resize=t,window.addEventListener("resize",t,!1)):(t=n.store.resize,window.removeEventListener("resize",t,!1))},_cleanStore:function(){var e=this.store;e.sentence=e.nextArr=e.translationSpans=null,e.words=e.clones=[]},_saveState:function(){var e=this.state,t=localStorage;t.setItem("level",e.level),t.setItem("no",e.no),console.log("state saved")},_loadState:function(){var e=this.state,t=localStorage;t.length>0&&(e.level=t.getItem("level"),e.no=t.getItem("no"),console.log("state loaded"))},_resetState:function(){var e=localStorage;e.length>0&&(e.clear(),console.log("reset"))},_debounce:function(e,t,n){var o;return function(){var s=this,a=arguments,r=function(){o=null,n||e.apply(s,a)},i=n&&!o;clearTimeout(o),o=setTimeout(r,t),i&&e.apply(s,a)}},_destroy:function(e){try{var t=e.parentNode,n=e.cloneNode(!0),o=t.replaceChild(n,e),s=t.removeChild(n);e=n=o=s=null}catch(a){console.log(a)}},_compareArrays:function(e,t){if(e&&t){if(e.length!==t.length)return!1;for(var n,o=e.length;o>n;n++)if(e[n]!==t[n])return!1;return!0}},_checkSpill:function(e,t){var n=this,o=t.every(function(t,o,s){n._compareArrays(e,t)});return o}};var sentence=new Sentence;