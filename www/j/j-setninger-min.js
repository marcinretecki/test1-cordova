function Sentence(){this.store={section:document.getElementById("section"),content:document.getElementById("content"),footer:document.getElementById("wrapper-buttons"),contentPosition:null,sentence:null,words:[],clones:[],wordPositions:[],itemsOnBoard:null,wrapper:null,wrapperBack:null,wrapperBackHeight:0,wrapperBackTop:0,nextArr:null,translationSpans:[],menuItems:[]},this.opts={easing:[.645,.045,.355,1],duration:200,valueX:400},this.state={transIn:!1,btns:{showTrans:!1,backHome:!1,nextArr:!1},level:"home",a:0,b:0,c:0,pct:[]},this._loadState(),this._begin()}Sentence.prototype={constructor:Sentence,_begin:function(){var t=this.store.content;this.store.contentPosition=t.getBoundingClientRect(),this._attachListeners(),"home"===this.state.level?(this._createMenu(),this.menuIn()):this._newSentence()},_newSentence:function(){this._changeColor(),this._removeHome(),this._toggleFooter(),this._getSentence(),this._createItemsOnBoard(),this._createSentence(),this._createClones(),this._createWrapperBack(),this._createTranslation(),this._createNextArr(),this._newSortable(),this._watchResize(!0),this._saveState(),this._comeIn()},_finishedSentence:function(){var t=this.state.level,e=this.state[t];"home"!==t&&(this._destroySortable(),this.state[t]=e+1,this._saveState(),this.showTrans(),this._toggleItems(),this._toggleNextArr())},nextSentence:function(){var t=this.state.level;if("home"!==t){var e=this,s=this._debounce(function(){e._toggleItems(),e._removeSentence(),e._cleanStore(),e._getSentence(),e._createSentence(),e._createClones(),e._animateWrapperBack(),e._createTranslation(),e._createNextArr(),e._newSortable(),e._watchResize(!0),e._comeIn()},300);this._comeOut(s)}},backHome:function(){function t(){function t(){e._destroy(s),e._changeColor(),e._toggleFooter(),e._cleanStore(),e._createMenu(),e.menuIn()}e.state.level="home",e._saveState(),e._removeSentence(),e._removeWrapperBack(t)}if("home"!==this.state.level){var e=this,s=this.store.content.firstChild;this._watchResize(!1),this._comeOut(t)}},_createMenu:function(){var t=this,e=this.store.content,s=document.createElement("div"),n=document.createElement("button");s.className="items center",s.id="menu-home",n.className="btn-menu btn-menu-hidden";var o=n.cloneNode(!0),a=n.cloneNode(!0);this._getLevelsPct(),n.className+=" btn-menu-1",n.id="menuOutA",n.innerHTML='<span>Od podstaw</span><div class="percent">'+this.state.pct[0]+"%</div>",o.className+=" btn-menu-2",o.id="menuOutB",o.innerHTML='<span>Åšrednio-zaawansowane</span><div class="percent">'+this.state.pct[1]+"%</div>",a.className+=" btn-menu-3",a.id="menuOutC",a.innerHTML='<span>Zaawansowane</span><div class="percent">'+this.state.pct[2]+"%</div>",this.store.menuItems=[n,o,a],s.appendChild(n),s.appendChild(o),s.appendChild(a),e.appendChild(s)},_createItemsOnBoard:function(){var t=this.store.content,e=document.createElement("div");e.id="items",e.className="items items-on-board",this.store.itemsOnBoard=e,t.insertBefore(e,t.firstChild)},_createSentence:function(){var t=this.store.sentence,e=t.s,s=t.b;void 0===s&&(s=!1);var n=this.store.content,o=this.store.itemsOnBoard,a=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),c,l,h;for(a.id="wrapper-items",r.className="btn-outer",i.className="btn-word",r.appendChild(i),c=e[0].concat(),c=c.sort(function(){return.5-Math.random()});this._checkSpill(c,e);)c=c.sort(function(){return.5-Math.random()});for(var p=0,u=c.length;u>p;p++)l=r.cloneNode(!0),l.dataset.pos=p+1,l.firstChild.innerHTML=c[p],a.appendChild(l),h=this.store.words.push(l);this.store.wrapper=a,o.appendChild(a)},_createClones:function(){var t=this,e=this.store.wrapper,s=this.store.contentPosition,n=this.store.words,o=this.opts.valueX,a=[],r=[],i,c,l,h,p=document.createElement("div");p.className="clones",function(){for(var t=0,e=n.length;e>t;t++){var c=n[t];l=c.getBoundingClientRect(),a[t]={left:Math.round(l.left-s.left),top:Math.round(l.top-s.top),bottom:Math.round(l.bottom)},h=c.cloneNode(!0),h.className=h.className+" clone",Velocity.hook(h,"translateX",a[t].left+o+"px"),Velocity.hook(h,"translateY",a[t].top+"px"),p.appendChild(h),i=r.push(h)}}(),this.store.clones=r,this.store.wordPositions=a,e.parentNode.appendChild(p)},_createWrapperBack:function(){this._checkBackSize();var t=this,e=this.store.wrapper,s=this.store.wrapperBackHeight,n=this.store.wrapperBackTop,o=document.createElement("div");o.className="wrapper-back",o.style.height=s+"px",o.style.top=n+"px",Velocity.hook(o,"scaleY",0),this.store.wrapperBack=o,e.parentNode.appendChild(o),Velocity(o,{scaleY:[1,0]},{duration:1.5*t.opts.easing,easing:t.opts.easing,queue:!1})},_createTranslation:function(){var t=this.store.wrapperBack,e=this.store.sentence,s=e.t,n=document.createElement("p"),o=s.split(" "),a=[],r,i;n.id="translation",n.className="translation";for(var c=0,l=o.length;l>c;c++)r=document.createElement("span"),r.appendChild(document.createTextNode(o[c])),i=a.push(r),n.appendChild(r),l-1>c&&n.appendChild(document.createTextNode(" "));this.store.translationSpans=a,t.appendChild(n)},_createNextArr:function(){if("home"!==this.state.level){var t=this,e=this.store.itemsOnBoard,s=document.createElement("div"),n=document.createElement("button");s.className="wrapper-next-arr",n.className="next-arr",n.id="next-arr",n.type="button",n.innerHTML="&raquo",this.store.nextArr=n,n.addEventListener("click",function o(){t.nextSentence(),n.removeEventListener("click",o,!1)},!1),s.appendChild(n),e.appendChild(s)}},_newSortable:function(){var t=this,e=this.store.wrapper,s;e&&(s=new Sortable(e,{animation:0,onStart:function(e){t._toggleOpacity(e.item,"0.5")},onEnd:function(e){t._toggleOpacity(e.item,"1"),t._checkSentence()}}),this.store.sortable=s)},_removeHome:function(){try{var t=this.store.content,e=document.getElementById("menu-home"),s=e.cloneNode(!0),n=t.replaceChild(s,e),o=t.removeChild(s);n=o=null}catch(a){}},_removeFooter:function(){},_removeWrapperBack:function(t){var e=this,s=this.store.sentence.s[0].length,n=this.store.wrapperBack,o=this._debounce(function(){t()},50);Velocity(n,{scaleY:[0,1],opacity:[0,1]},{duration:1.5*e.opts.duration,easing:e.opts.easing,complete:function(t){t.forEach(function(t,e,s){o()})}})},_removeSentence:function(){var t=this.store.itemsOnBoard,e=this.store.wrapperBack;this._destroy(t.firstChild),this._destroy(t.firstChild),this._destroy(e.firstChild),this._destroy(t.lastChild)},_destroySortable:function(){var t=this.store.sortable;t.destroy(),this.store.sortable=null},menuIn:function(){for(var t=this,e=this.store.menuItems,s,n=0,o=e.length;o>n;n++)s=e[n],Velocity(s,{opacity:[1,0],translateX:[0,"200px"]},{duration:2*t.opts.duration,easing:t.opts.easing,delay:100*n})},menuOut:function(t){if("home"===this.state.level){var e=this,s=document.querySelectorAll(".btn-menu"),n;this.state.level=t;for(var o=0,a=s.length;a>o;o++)n=s[o],Velocity(n,{opacity:[0,1],translateX:["-200px",0]},{duration:2*e.opts.duration,easing:e.opts.easing,delay:100*o,complete:function(t){t.forEach(function(t,n,o){t===s[a-1]&&e._newSentence()})}})}},animate:function(){var t=this,e=this.store.words,s=this.store.clones,n=this.store.contentPosition,o=this.store.wordPositions,a=[],r=e.length,i,c,l,h,p,u;!function(){for(var t=0;r>t;t++);}(),function(){for(var t=0;r>t;t++)i=e[t].getBoundingClientRect(),a[t]={left:Math.round(i.left-n.left),top:Math.round(i.top-n.top),bottom:Math.round(i.bottom-n.top)}}(),this.store.wordPositions=a,p=this._debounce(function(){for(var e=0;r>e;e++)Velocity(s[e],{translateX:[a[e].left,o[e].left],translateY:[a[e].top,o[e].top]},{duration:t.opts.duration,easing:t.opts.easing,queue:!1})},10),p(),(u=this._debounce(function(){t._animateWrapperBack()},200))()},_animateWrapperBack:function(){var t=this;if(wrapperBack=this.store.wrapperBack,changedWrapperBack=this._checkBackSize(),changedWrapperBack){var e=this.store.wrapperBackHeight,s=this.store.wrapperBackTop;Velocity(wrapperBack,{height:e,top:s},{duration:1.5*t.opts.duration,easing:t.opts.easing,queue:!1})}},showTrans:function(){if(!this.state.transIn&&"home"!==this.state.level){for(var t=this,e=this.store.translationSpans,s,n=0,o=e.length;o>n;n++)s=e[n],Velocity(s,{opacity:[1,0],translateX:[0,"200px"]},{duration:t.opts.duration,easing:t.opts.easing,delay:100*n});this._toggleBtn("showTrans"),this.state.transIn=!0}},_toggleFooter:function(){var t=this.state.level,e=this.state.transIn,s=this.store.footer;"home"===t?s.parentNode.className="app-footer":s.parentNode.className+=" app-footer-sentence",e||this._toggleBtn("showTrans"),this._toggleBtn("backHome")},_toggleBtn:function(t){var e=this;state=this.state.btns[t],clicked=document.getElementById(t),className="btn-footer-hidden",state?(state=!1,this._toggleClass(clicked,className)):(state=!0,this._toggleClass(clicked,className))},_toggleNextArr:function(){if("home"!==this.state.level){var t=this,e=this.store.nextArr;this.state.btns.nextArr?(this.state.btns.nextArr=!1,Velocity(e,{scale:[0,1]},{duration:2*t.opts.duration,easing:t.opts.easing,delay:t.opts.duration,display:"none"})):(this.state.btns.nextArr=!0,Velocity(e,{scale:[1,0]},{duration:2*t.opts.duration,easing:t.opts.easing,delay:t.opts.duration,display:"block"}))}},_comeIn:function(){var t=this,e=this.store.wordPositions,s=this.store.clones,n=this.opts.valueX,o;!function(){for(var a=0,r=s.length;r>a;a++)o=e[a].left,Velocity(s[a],{opacity:1,translateX:[o,o+n]},{duration:t.opts.duration,easing:t.opts.easing,delay:100*a+t.opts.duration,queue:!1})}()},_comeOut:function(t){if("home"!==this.state.level){var e=this,s=this.store.wordPositions,n=this.store.clones,o=this.store.nextArr,a=this.state.transIn,r=this.opts.valueX,i=this.store.wrapper.childNodes,c,l,h,p=this._debounce(function(){t()},50);if(a){var u=this.store.translationSpans;!function(){for(var t=0,s=u.length;s>t;t++)c=u[t],Velocity(c,{opacity:[0,1],translateX:["-200px",0]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*t})}()}this.state.btns.nextArr&&this._toggleNextArr(),function(){for(var t=0,o=i.length;o>t;t++)h=i[t].dataset.pos-1,l=s[h].left,Velocity(n[h],{opacity:[0,1],translateX:[l-r,l]},{duration:e.opts.duration,easing:e.opts.easing,delay:100*t+e.opts.duration,queue:!1,complete:function(t){t.forEach(function(t,e,s){t===n[o-1]&&p()})}})}()}},_changeColor:function(){var t=this.store.section,e=" section-100",s=this.state.level;switch(s){case"a":t.className="section-green"+e;break;case"b":t.className="section-orange"+e;break;case"c":t.className="section-red"+e;break;case"home":t.className="section-dark"+e}},_toggleOpacity:function(t,e){try{var s=t.dataset.pos-1,n=this.store.clones[s];Velocity.hook(n,"opacity",e)}catch(o){}},_toggleItems:function(){var t=this.store.itemsOnBoard;className=t.className,"items items-on-board"===className?className+=" items-off":className="items items-on-board"},_getSentence:function(){try{var t=this.state.level,e=this.state[t],s;switch(t){case"a":s=arrayA(e,!1);break;case"b":s=arrayB(e,!1);break;case"c":s=arrayC(e,!1)}return this.store.sentence=s}catch(n){console.log(n)}},_getLevelsPct:function(){try{var t=this.state,e=arrayA(!1,!0),s=arrayB(!1,!0),n=arrayC(!1,!0),o=Math.round(100*t.a/e),a=Math.round(100*t.b/s),r=Math.round(100*t.c/n);t.pct=[o,a,r]}catch(i){}},_checkSentence:function(){var t=this,e=this.store.sentence,s=e.s,n=this.store.wrapper,o=[],a,r,i;(a=this._debounce(function(){r=n.querySelectorAll(".btn-word"),function(){for(var t=0,e=r.length;e>t;t++)i=o.push(r[t].innerHTML)}(),t._checkSpill(o,s)&&t._finishedSentence(),console.log("check sentence")},200))()},_checkBackSize:function(){try{for(var t=this.store.wordPositions,e=this.store.wrapperBackHeight,s=[],n=[],o,a,r,i,c=0,l=t.length;l>c;c++)o=t[c].top,a=t[c].bottom,s.push(o),n.push(a);if(console.log("check back size"),s.sort(),n.sort(),r=Math.floor(n[n.length-1]-s[0])+6,i=Math.floor(s[0]-3),e!==r)return this.store.wrapperBackHeight=r,this.store.wrapperBackTop=i,!0}catch(h){}},_watchResize:function(t){var e=this,s;t?(s=e._debounce(function(){e.animate()},250),e.store.resize=s,window.addEventListener("resize",s,!1),console.log("watch resize on")):(s=e.store.resize,window.removeEventListener("resize",s,!1),console.log("watch resize off"))},_attachListeners:function(){var t=this;document.addEventListener("click",function e(s){var n=s.target;switch(n.id){case"showTrans":t.showTrans();break;case"backHome":t.backHome();break;case"resetState":t.resetState();break;case"menuOutA":t.menuOut("a");break;case"menuOutB":t.menuOut("b");break;case"menuOutC":t.menuOut("c")}})},_cleanStore:function(){this.store.sentence=this.store.wrapper=this.store.nextArr=this.store.translationSpans=null,this.store.wrapperBackHeight=this.store.wrapperBackTop=0,this.store.words=this.store.clones=this.store.wordPositions=this.store.translationSpans=[],this.state.transIn=this.state.btns.nextArr=!1,console.log("cleaned store")},_saveState:function(){var t=this.state,e=t.level,s=localStorage;s.setItem("level",e),console.log("saved level"),"home"!==e&&(s.setItem(e,t[e]),console.log("saved number"))},_loadState:function(){if(localStorage.length>0){var t=localStorage.getItem("level");this.state.level=t,this.state.a=parseInt(localStorage.getItem("a")),this.state.b=parseInt(localStorage.getItem("b")),this.state.c=parseInt(localStorage.getItem("c")),console.log("state loaded")}},resetState:function(){var t=localStorage;t.length>0&&(t.clear(),document.location.reload())},_debounce:function(t,e,s){var n;return function(){var o=this,a=arguments,r=function(){n=null,s||t.apply(o,a)},i=s&&!n;clearTimeout(n),n=setTimeout(r,e),i&&t.apply(o,a)}},_toggleClass:function(t,e){if(t.classList)t.classList.toggle(e);else{var s=t.className.split(" "),n=s.indexOf(e);n>=0?s.splice(n,1):s.push(e),t.className=s.join(" ")}},_destroy:function(t){try{var e=t.parentNode,s=t.cloneNode(!0),n=e.replaceChild(s,t),o=e.removeChild(s);t=s=n=o=null}catch(a){console.log(a)}},_compareArrays:function(t,e){if(t&&e){if(t.length!==e.length)return!1;for(var s=0,n=t.length;n>s;s++)if(t[s]!==e[s])return!1;return!0}},_checkSpill:function(t,e){var s=this,n=e.every(function(e,n,o){return s._compareArrays(t,e)});return n}};var sentence=new Sentence;